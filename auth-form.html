<!--
  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
  ‚ïë  Supabase Auth Form - Google + Facebook + Magic Link             ‚ïë
  ‚ïë  Version: 2.3 - Security Update (Open Redirect Protection)       ‚ïë
  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

  üìñ DOCUMENTATION: See docs/AUTH-FORM-REDIRECT-GUIDE.md

  üöÄ QUICK SETUP:
  1. Paste this code into WordPress page (HTML widget/block)
  2. Configure AUTH_CONFIG in <script> section below
  3. Done!

  üí° TIP: Use Settings page to configure Supabase credentials and pages
-->

<style>
  /* ========== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ========== */

  .sb-auth-wrapper {
    max-width: 440px;
    margin: 0 auto;
    padding: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  .sb-auth-card {
    background: #ffffff;
    border-radius: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 20px 40px rgba(0, 0, 0, 0.08);
    padding: 48px 40px;
    transition: box-shadow 0.3s ease;
  }

  .sb-auth-card:hover {
    box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1), 0 24px 48px rgba(0, 0, 0, 0.12);
  }

  /* ========== –ó–ê–ì–û–õ–û–í–û–ö ========== */

  .sb-auth-header {
    text-align: center;
    margin-bottom: 32px;
  }

  .sb-auth-logo {
    font-size: 32px;
    font-weight: 700;
    color: #111827;
    margin: 0 0 8px 0;
    letter-spacing: -0.5px;
  }

  .sb-auth-tagline {
    font-size: 15px;
    color: #6b7280;
    margin: 0;
    line-height: 1.5;
  }

  /* ========== –≠–ö–†–ê–ù–´ ========== */

  .sb-screen {
    display: none;
  }

  .sb-screen.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ========== –ö–ù–û–ü–ö–ò OAUTH ========== */

  .sb-oauth-section {
    margin-bottom: 24px;
  }

  .sb-oauth-btn {
    width: 100%;
    padding: 14px 16px;
    margin-bottom: 16px;
    border: 1.5px solid #e5e7eb;
    border-radius: 12px;
    background: #ffffff;
    font-size: 15px;
    font-weight: 600;
    color: #374151;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    font-family: inherit;
  }

  .sb-oauth-btn:last-child {
    margin-bottom: 0;
  }

  .sb-oauth-btn:hover {
    background: #f9fafb;
    border-color: #d1d5db;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .sb-oauth-btn:active {
    transform: translateY(0);
  }

  .sb-oauth-icon {
    width: 20px;
    height: 20px;
  }

  /* ========== –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ ========== */

  .sb-divider {
    display: flex;
    align-items: center;
    margin: 24px 0;
    color: #9ca3af;
    font-size: 13px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .sb-divider::before,
  .sb-divider::after {
    content: '';
    flex: 1;
    border-bottom: 1px solid #e5e7eb;
  }

  .sb-divider::before {
    margin-right: 16px;
  }

  .sb-divider::after {
    margin-left: 16px;
  }

  /* ========== EMAIL INPUT ========== */

  .sb-email-section {
    margin-bottom: 16px;
  }

  .sb-email-input {
    width: 100%;
    padding: 14px 16px;
    border: 1.5px solid #e5e7eb;
    border-radius: 12px;
    font-size: 15px;
    color: #111827;
    transition: all 0.2s ease;
    box-sizing: border-box;
    font-family: inherit;
  }

  .sb-email-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
  }

  .sb-email-input::placeholder {
    color: #9ca3af;
  }

  /* ========== –ö–ù–û–ü–ö–ò ========== */

  .sb-btn {
    width: 100%;
    padding: 14px 16px;
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: inherit;
  }

  .sb-btn-primary {
    background: #111827;
    color: #ffffff;
  }

  .sb-btn-primary:hover {
    background: #1f2937;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .sb-btn-primary:active {
    transform: translateY(0);
  }

  .sb-btn-primary:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
  }

  /* ========== CHECK EMAIL SCREEN ========== */

  .sb-check-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 24px;
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sb-check-icon svg {
    width: 32px;
    height: 32px;
    color: #3b82f6;
  }

  .sb-check-title {
    font-size: 24px;
    font-weight: 700;
    color: #111827;
    margin: 0 0 12px 0;
    text-align: center;
  }

  .sb-check-text {
    font-size: 15px;
    color: #6b7280;
    text-align: center;
    line-height: 1.6;
    margin: 0 0 8px 0;
  }

  .sb-user-email {
    color: #111827;
    font-weight: 600;
  }

  .sb-check-instruction {
    font-size: 14px;
    color: #9ca3af;
    text-align: center;
    margin: 0 0 24px 0;
  }

  /* ========== CODE INPUT ========== */

  .sb-code-toggle {
    text-align: center;
    margin: 24px 0;
  }

  .sb-link {
    color: #3b82f6;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .sb-link:hover {
    color: #2563eb;
    text-decoration: underline;
  }

  .sb-code-section {
    display: none;
    margin-top: 24px;
  }

  .sb-code-section.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  .sb-code-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    text-align: center;
  }

  .sb-code-input {
    width: 100%;
    padding: 14px 16px;
    border: 1.5px solid #e5e7eb;
    border-radius: 12px;
    font-size: 20px;
    color: #111827;
    text-align: center;
    letter-spacing: 6px;
    font-weight: 600;
    transition: all 0.2s ease;
    box-sizing: border-box;
    font-family: 'Courier New', monospace;
  }

  .sb-code-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
  }

  .sb-code-input::placeholder {
    color: #d1d5db;
    letter-spacing: 4px;
  }

  .sb-verify-btn {
    margin-top: 12px;
  }

  /* ========== FOOTER LINKS ========== */

  .sb-footer {
    text-align: center;
    margin-top: 20px;
    font-size: 14px;
    color: #6b7280;
  }

  /* ========== –°–û–û–ë–©–ï–ù–ò–Ø ========== */

  .sb-message {
    padding: 12px 16px;
    border-radius: 10px;
    font-size: 14px;
    margin-bottom: 16px;
    text-align: center;
    display: none;
  }

  .sb-message.active {
    display: block;
  }

  .sb-error {
    background: #fef2f2;
    border: 1px solid #fecaca;
    color: #dc2626;
    animation: shake 0.3s ease;
  }

  .sb-success {
    background: #f0fdf4;
    border: 1px solid #bbf7d0;
    color: #16a34a;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
  }

  /* ========== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø ========== */

  @media (max-width: 480px) {
    .sb-auth-wrapper {
      padding: 16px;
    }

    .sb-auth-card {
      padding: 40px 28px;
      border-radius: 16px;
    }

    .sb-auth-logo {
      font-size: 28px;
    }

    .sb-auth-tagline {
      font-size: 14px;
    }

    .sb-oauth-btn,
    .sb-email-input,
    .sb-btn {
      padding: 12px 14px;
      font-size: 14px;
    }

    .sb-check-icon {
      width: 56px;
      height: 56px;
      margin-bottom: 20px;
    }

    .sb-check-icon svg {
      width: 28px;
      height: 28px;
    }

    .sb-check-title {
      font-size: 22px;
    }

    .sb-check-text {
      font-size: 14px;
    }
  }

  @media (max-width: 360px) {
    .sb-auth-card {
      padding: 32px 24px;
    }

    .sb-auth-logo {
      font-size: 24px;
    }
  }
</style>

<!-- –§–û–†–ú–ê -->
<div class="sb-auth-wrapper">
  <div class="sb-auth-card">
    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="sb-message sb-error" id="sb-error-msg"></div>
    <div class="sb-message sb-success" id="sb-success-msg"></div>

    <!-- ========== –≠–ö–†–ê–ù 1: EMAIL + OAUTH ========== -->
    <div class="sb-screen active" id="sb-screen-1">
      <!-- OAuth –∫–Ω–æ–ø–∫–∏ -->
      <div class="sb-oauth-section">
        <!-- Google -->
        <button class="sb-oauth-btn" id="sb-google-btn">
          <svg class="sb-oauth-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
          </svg>
          Continue with Google
        </button>

        <!-- Facebook -->
        <button class="sb-oauth-btn" id="sb-facebook-btn">
          <svg class="sb-oauth-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" fill="#1877F2"/>
          </svg>
          Continue with Facebook
        </button>
      </div>

      <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
      <div class="sb-divider">or</div>

      <!-- Email —Ñ–æ—Ä–º–∞ -->
      <form id="sb-email-form">
        <div class="sb-email-section">
          <input
            type="email"
            id="sb-email-input"
            class="sb-email-input"
            placeholder="Enter your email"
            required
            autocomplete="email"
          >
        </div>
        <button type="submit" class="sb-btn sb-btn-primary">
          Continue with email
        </button>
      </form>
    </div>

    <!-- ========== –≠–ö–†–ê–ù 2: CHECK EMAIL ========== -->
    <div class="sb-screen" id="sb-screen-2">
      <!-- –ò–∫–æ–Ω–∫–∞ -->
      <div class="sb-check-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
        </svg>
      </div>

      <!-- –¢–µ–∫—Å—Ç -->
      <h3 class="sb-check-title">Check your email</h3>
      <p class="sb-check-text">
        To continue, click the link sent to<br>
        <span class="sb-user-email" id="sb-display-email">your@email.com</span>
      </p>
      <p class="sb-check-instruction">
        Click the magic link in the email to sign in
      </p>

      <!-- –ö–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
      <div class="sb-code-toggle">
        <a class="sb-link" id="sb-show-code">Have a verification code instead?</a>
      </div>

      <div class="sb-code-section" id="sb-code-section">
        <label class="sb-code-label" for="sb-code-input">Enter verification code</label>
        <input
          type="text"
          id="sb-code-input"
          class="sb-code-input"
          placeholder="000000"
          maxlength="6"
          pattern="[0-9]{6}"
          inputmode="numeric"
        >
        <button class="sb-btn sb-btn-primary sb-verify-btn" id="sb-verify-btn">
          Verify Email Address
        </button>
      </div>

      <!-- Footer -->
      <div class="sb-footer">
        Not seeing the email in your inbox? <a class="sb-link" id="sb-resend">Try sending again</a>
      </div>
    </div>
  </div>
</div>

<!-- –ó–∞–≥—Ä—É–∑–∫–∞ Supabase SDK (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–ª–∞–≥–∏–Ω–æ–º) -->
<script>
  // window.SUPABASE_CFG —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –ø–ª–∞–≥–∏–Ω–æ–º —á–µ—Ä–µ–∑ wp_enqueue_scripts
  // window.supabase —Ç–æ–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –ø–ª–∞–≥–∏–Ω–æ–º
</script>

<script>
  // ========== SUPABASE AUTH –° –£–ú–ù–´–ú–ò –†–ï–î–ò–†–ï–ö–¢–ê–ú–ò ==========

  (function() {
    'use strict';

    // –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–ø—É—Å–∫–∞ –µ—Å–ª–∏ DOM –Ω–µ –≥–æ—Ç–æ–≤
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAuthForm);
    } else {
      initAuthForm();
    }

    function initAuthForm() {
      try {
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========

        const AUTH_CONFIG = {
      // üéØ –ù–ê–°–¢–†–û–ô–ö–ê –°–¢–†–ê–ù–ò–¶ –ë–õ–ê–ì–û–î–ê–†–ù–û–°–¢–ò –î–õ–Ø –ù–û–í–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
      //
      // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (—Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑):
      // 1. URL –ø–∞—Ä–∞–º–µ—Ç—Ä ?thank_you=/custom-page/  (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Å—ë)
      // 2. Mapping –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª (referrer)
      // 3. Default —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (fallback)
      //
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // –†–ï–ñ–ò–ú 1 - –°–¢–ê–ù–î–ê–†–¢–ù–´–ô (–æ–¥–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è –≤—Å–µ—Ö):
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // thankYouPages: {
      //   'default': '/thank-you/'
      // }
      //
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // –†–ï–ñ–ò–ú 2 - –ü–ê–†–ù–´–ô (—Ä–∞–∑–Ω—ã–µ thank-you –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ª–µ–Ω–¥–∏–Ω–≥–æ–≤):
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // thankYouPages: {
      //   '/landing-premium/': '/thank-you-premium/',
      //   '/landing-basic/': '/thank-you-basic/',
      //   '/webinar/': '/thank-you-webinar/',
      //   'default': '/thank-you/'
      // }
      //
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // –†–ï–ñ–ò–ú 3 - –ì–ò–ë–ö–ò–ô (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ URL):
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // –ù–∞ –ª–µ–Ω–¥–∏–Ω–≥–µ –¥–æ–±–∞–≤—å –ø–∞—Ä–∞–º–µ—Ç—Ä:
      // <a href="/auth/?thank_you=/special-thank-you/">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      //
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò (–†–µ–∂–∏–º 2 - –ø–∞—Ä–Ω—ã–π):
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      thankYouPages: {
        'default': window.SUPABASE_CFG?.thankYouUrl || '/registr/'  // Thank You Page from Settings
      },

      // üè† –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏)
      defaultRedirect: '/',

      // ‚è±Ô∏è –ü–æ—Ä–æ–≥ "–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (60 —Å–µ–∫ = –Ω–µ–¥–∞–≤–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
      newUserThreshold: 60000
    };

    // ========== –≠–õ–ï–ú–ï–ù–¢–´ DOM ==========

    const screen1 = document.getElementById('sb-screen-1');
    const screen2 = document.getElementById('sb-screen-2');
    const emailForm = document.getElementById('sb-email-form');
    const emailInput = document.getElementById('sb-email-input');
    const displayEmail = document.getElementById('sb-display-email');
    const googleBtn = document.getElementById('sb-google-btn');
    const facebookBtn = document.getElementById('sb-facebook-btn');
    const showCodeBtn = document.getElementById('sb-show-code');
    const codeSection = document.getElementById('sb-code-section');
    const codeInput = document.getElementById('sb-code-input');
    const verifyBtn = document.getElementById('sb-verify-btn');
    const resendBtn = document.getElementById('sb-resend');
    const errorMsg = document.getElementById('sb-error-msg');
    const successMsg = document.getElementById('sb-success-msg');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã
    const requiredElements = {
      screen1, screen2, emailForm, emailInput, displayEmail,
      googleBtn, facebookBtn, showCodeBtn, codeSection, codeInput,
      verifyBtn, resendBtn, errorMsg, successMsg
    };

    for (const [name, element] of Object.entries(requiredElements)) {
      if (!element) {
        console.error(`‚ùå Supabase Auth Form: Required element '${name}' not found!`);
        console.log('üí° Make sure the HTML structure is complete');
        return; // –í—ã—Ö–æ–¥–∏–º –±–µ–∑ –æ—à–∏–±–∫–∏ —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
      }
    }

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE ==========

    let supabaseClient;
    let authSubscription; // –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    let isInitialized = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

    function initSupabase() {
      // –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
      if (isInitialized) {
        console.log('‚ö†Ô∏è Supabase already initialized, skipping');
        return true;
      }

      if (!window.SUPABASE_CFG || !window.supabase) {
        return false;
      }

      try {
        const { createClient } = window.supabase;
        supabaseClient = createClient(
          window.SUPABASE_CFG.url,
          window.SUPABASE_CFG.anon
        );

        // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
        if (authSubscription) {
          authSubscription.data?.subscription?.unsubscribe();
        }

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        authSubscription = supabaseClient.auth.onAuthStateChange(handleAuthChange);

        isInitialized = true; // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
        console.log('‚úÖ Supabase Auth initialized');
        return true;
      } catch (error) {
        console.error('Supabase init error:', error);
        showError('Failed to initialize Supabase');
        return false;
      }
    }

    // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å retry
    function waitForSupabase(callback, maxAttempts = 20) {
      let attempts = 0;

      const checkAndInit = () => {
        attempts++;

        if (window.SUPABASE_CFG && window.supabase) {
          // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞
          if (initSupabase()) {
            callback();
          } else {
            showError('Supabase initialization failed. Check console.');
          }
        } else if (attempts >= maxAttempts) {
          // –ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
          showError('Supabase not configured. Check wp-config.php or plugin activation.');
          console.error('‚ùå SUPABASE_CFG not found after', maxAttempts, 'attempts');
          console.log('üí° Make sure supabase-bridge plugin is activated and wp-config.php is configured');
        } else {
          // –ü—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑ —á–µ—Ä–µ–∑ 100ms
          setTimeout(checkAndInit, 100);
        }
      };

      checkAndInit();
    }

    // ========== –£–¢–ò–õ–ò–¢–´ –†–ï–î–ò–†–ï–ö–¢–û–í ==========

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const ORIGIN_PAGE = (function() {
      const params = new URLSearchParams(window.location.search);

      // 1. Explicit –ø–∞—Ä–∞–º–µ—Ç—Ä redirect_to (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
      if (params.get('redirect_to')) {
        console.log('üéØ ORIGIN_PAGE: from ?redirect_to =', params.get('redirect_to'));
        return params.get('redirect_to');
      }

      // 2. Referrer (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª)
      if (document.referrer) {
        try {
          const referrerUrl = new URL(document.referrer);
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ —Ç–æ—Ç –∂–µ –¥–æ–º–µ–Ω
          if (referrerUrl.origin === window.location.origin) {
            console.log('üéØ ORIGIN_PAGE: from referrer =', referrerUrl.pathname);
            return referrerUrl.pathname;
          }
        } catch (e) {
          console.warn('Invalid referrer:', e);
        }
      }

      // 3. Fallback - —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
      console.log('üéØ ORIGIN_PAGE: fallback (current page) =', window.location.pathname);
      return window.location.pathname;
    })();

    // Security: Validate redirect URL to prevent open redirect attacks
    function isSafeRedirect(url) {
      if (!url) return false;

      // Allow relative paths (start with /)
      if (url.startsWith('/')) return true;

      // Check if URL is on same domain
      try {
        const urlObj = new URL(url, window.location.origin);
        return urlObj.origin === window.location.origin;
      } catch (e) {
        console.warn('Invalid redirect URL:', url);
        return false;
      }
    }

    function getReturnUrl() {
      // –ï—Å–ª–∏ origin page = —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º defaultRedirect (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å loop)
      if (ORIGIN_PAGE === window.location.pathname) {
        console.log('‚ö†Ô∏è ORIGIN_PAGE is current page, using defaultRedirect');
        return AUTH_CONFIG.defaultRedirect;
      }
      // –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏
      // Security: validate before returning
      if (!isSafeRedirect(ORIGIN_PAGE)) {
        console.warn('‚ö†Ô∏è Unsafe redirect detected, using defaultRedirect');
        return AUTH_CONFIG.defaultRedirect;
      }
      return ORIGIN_PAGE;
    }

    function getThankYouPage() {
      const params = new URLSearchParams(window.location.search);

      // 1. Explicit –ø–∞—Ä–∞–º–µ—Ç—Ä thank_you (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
      const customPage = params.get('thank_you');
      if (customPage) {
        // Security: validate custom page parameter
        if (!isSafeRedirect(customPage)) {
          console.warn('‚ö†Ô∏è Unsafe thank_you parameter detected, using default');
          return AUTH_CONFIG.thankYouPages.default;
        }
        return customPage;
      }

      // 2. –ò—â–µ–º –≤ mapping –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª
      if (AUTH_CONFIG.thankYouPages[ORIGIN_PAGE]) {
        return AUTH_CONFIG.thankYouPages[ORIGIN_PAGE];
      }

      // 3. Default fallback
      return AUTH_CONFIG.thankYouPages.default;
    }

    function isNewUser(user) {
      if (!user || !user.created_at) return false;

      const createdAt = new Date(user.created_at);
      const now = new Date();
      const diff = now - createdAt;

      return diff < AUTH_CONFIG.newUserThreshold;
    }

    // ========== –û–ë–†–ê–ë–û–¢–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========

    let isRedirecting = false; // –§–ª–∞–≥ —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
    const processingTokens = new Set(); // In-memory Set –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç race condition

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±—ã–ª –ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ sessionStorage)
    let userTriggeredAuth = sessionStorage.getItem('sb_auth_triggered') === 'true';

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏—à—ë–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ Magic Link (–µ—Å—Ç—å —Ç–æ–∫–µ–Ω –≤ URL hash)
    const hasMagicLinkToken = window.location.hash.includes('access_token=');

    async function handleAuthChange(event, session) {
      // –ö–†–ò–¢–ò–ß–ù–û #0: –ü—Ä–æ–≤–µ—Ä—è–µ–º isRedirecting –ü–ï–†–í–´–ú –î–ï–õ–û–ú (–¥–æ –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫)
      // –≠—Ç–æ —Å–∞–º–∞—è —Ä–∞–Ω–Ω—è—è –∑–∞—â–∏—Ç–∞ –æ—Ç race condition
      if (isRedirecting) {
        console.log('‚ö†Ô∏è Already redirecting, skipping duplicate event');
        return;
      }

      console.log('Auth event:', event, 'userTriggered:', userTriggeredAuth, 'hasMagicLink:', hasMagicLinkToken);

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –¥–µ–ª–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç
      // –î–∞, –µ—Å–ª–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É –ò–õ–ò –ø—Ä–∏—à—ë–ª –ø–æ Magic Link
      const shouldRedirect = userTriggeredAuth || hasMagicLinkToken;

      // –†–µ–¥–∏—Ä–µ–∫—Ç–∏–º –¢–û–õ–¨–ö–û –µ—Å–ª–∏:
      // 1. –°–æ–±—ã—Ç–∏–µ = SIGNED_IN
      // 2. –ï—Å—Ç—å —Å–µ—Å—Å–∏—è
      // 3. (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É –ò–õ–ò –ø—Ä–∏—à—ë–ª –ø–æ Magic Link)
      if (event === 'SIGNED_IN' && session && shouldRedirect) {
        const tokenKey = session.access_token.substring(0, 20);

        // –ö–†–ò–¢–ò–ß–ù–û #1: In-memory –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç race condition –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
        if (processingTokens.has(tokenKey)) {
          console.log('‚ö†Ô∏è Token already processing (in-memory lock), skipping');
          return;
        }

        // –ö–†–ò–¢–ò–ß–ù–û #2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥–∏ –°–†–ê–ó–£ –ò –°–ò–ù–•–†–û–ù–ù–û
        processingTokens.add(tokenKey);
        isRedirecting = true; // ‚Üê –ü–µ—Ä–µ–Ω–µ—Å–ª–∏ –°–Æ–î–ê - —Ä–∞–Ω—å—à–µ!

        // –ö–†–ò–¢–ò–ß–ù–û #3: localStorage –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∑–∞—â–∏—Ç–∞ –º–µ–∂–¥—É —Ç–∞–±–∞–º–∏/–æ–∫–Ω–∞–º–∏)
        const processedTokenKey = 'sb_processed_' + tokenKey;
        if (localStorage.getItem(processedTokenKey)) {
          console.log('‚ö†Ô∏è Token already processed (localStorage), skipping');
          processingTokens.delete(tokenKey); // –û—á–∏—â–∞–µ–º in-memory lock
          isRedirecting = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
          return;
        }

        // –ü–æ–º–µ—á–∞–µ–º –≤ localStorage
        localStorage.setItem(processedTokenKey, 'processing');

        const user = session.user;
        const accessToken = session.access_token;

        try {
          // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å WordPress
          const wpResponse = await fetch(window.location.origin + '/wp-json/supabase-auth/callback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ access_token: accessToken })
          });

          const wpData = await wpResponse.json();

          if (!wpResponse.ok) {
            throw new Error(wpData.message || 'WordPress authentication failed');
          }

          // ‚úÖ –ü–æ–º–µ—á–∞–µ–º —Ç–æ–∫–µ–Ω –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ WordPress
          localStorage.setItem(processedTokenKey, 'true');
          // –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
          setTimeout(() => localStorage.removeItem(processedTokenKey), 300000);

          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—É–¥–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å
          const redirectUrl = isNewUser(user)
            ? getThankYouPage()
            : getReturnUrl();

          console.log('Redirecting to:', redirectUrl, '(new user:', isNewUser(user), ')');

          // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥ –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
          sessionStorage.removeItem('sb_auth_triggered');

          // –†–µ–¥–∏—Ä–µ–∫—Ç
          window.location.href = redirectUrl;

        } catch (error) {
          console.error('Auth error:', error);
          showError(error.message || 'Authentication failed');

          // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ (–ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞)
          processingTokens.delete(tokenKey); // –û—á–∏—â–∞–µ–º in-memory lock
          localStorage.removeItem(processedTokenKey); // –û—á–∏—â–∞–µ–º localStorage
          isRedirecting = false;
        }
      }
    }

    // ========== EMAIL MAGIC LINK ==========

    emailForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = emailInput.value.trim();

      if (!email) return;

      if (!supabaseClient) {
        showError('Supabase not initialized yet. Please wait...');
        return;
      }

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª email
      userTriggeredAuth = true;
      sessionStorage.setItem('sb_auth_triggered', 'true');
      console.log('üéØ User submitted email for magic link');

      try {
        // –û—Ç–ø—Ä–∞–≤–∫–∞ magic link
        const { error } = await supabaseClient.auth.signInWithOtp({
          email: email,
          options: {
            emailRedirectTo: window.location.origin + window.location.pathname
          }
        });

        if (error) throw error;

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω 2
        displayEmail.textContent = email;
        switchScreen(2);
        showSuccess('Magic link sent! Check your email.');

      } catch (error) {
        console.error('Magic link error:', error);
        showError(error.message || 'Failed to send magic link');
      }
    });

    // ========== GOOGLE OAUTH ==========

    googleBtn.addEventListener('click', async () => {
      if (!supabaseClient) {
        showError('Supabase not initialized yet. Please wait...');
        return;
      }

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É
      userTriggeredAuth = true;
      sessionStorage.setItem('sb_auth_triggered', 'true');
      console.log('üéØ User clicked Google OAuth button');

      try {
        const { error } = await supabaseClient.auth.signInWithOAuth({
          provider: 'google',
          options: {
            redirectTo: window.location.origin + window.location.pathname
          }
        });

        if (error) throw error;

      } catch (error) {
        console.error('OAuth error:', error);
        showError(error.message || 'OAuth authentication failed');
      }
    });

    // ========== FACEBOOK OAUTH ==========

    facebookBtn.addEventListener('click', async () => {
      if (!supabaseClient) {
        showError('Supabase not initialized yet. Please wait...');
        return;
      }

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É
      userTriggeredAuth = true;
      sessionStorage.setItem('sb_auth_triggered', 'true');
      console.log('üéØ User clicked Facebook OAuth button');

      try {
        const { error } = await supabaseClient.auth.signInWithOAuth({
          provider: 'facebook',
          options: {
            redirectTo: window.location.origin + window.location.pathname,
            scopes: 'email public_profile'
          }
        });

        if (error) throw error;

      } catch (error) {
        console.error('OAuth error:', error);
        showError(error.message || 'OAuth authentication failed');
      }
    });

    // ========== VERIFICATION CODE ==========

    showCodeBtn.addEventListener('click', (e) => {
      e.preventDefault();
      codeSection.classList.add('active');
      showCodeBtn.style.display = 'none';
      codeInput.focus();
    });

    verifyBtn.addEventListener('click', async () => {
      const email = displayEmail.textContent;
      const code = codeInput.value.trim();

      if (code.length !== 6) {
        showError('Please enter a 6-digit code');
        return;
      }

      if (!supabaseClient) {
        showError('Supabase not initialized yet. Please wait...');
        return;
      }

      try {
        const { error } = await supabaseClient.auth.verifyOtp({
          email: email,
          token: code,
          type: 'email'
        });

        if (error) throw error;

        // handleAuthChange —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

      } catch (error) {
        console.error('Verification error:', error);
        showError(error.message || 'Invalid verification code');
      }
    });

    // ========== RESEND ==========

    resendBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      const email = displayEmail.textContent;

      if (!supabaseClient) {
        showError('Supabase not initialized yet. Please wait...');
        return;
      }

      try {
        const { error } = await supabaseClient.auth.signInWithOtp({
          email: email,
          options: {
            emailRedirectTo: window.location.origin + window.location.pathname
          }
        });

        if (error) throw error;

        showSuccess('Email sent again!');

      } catch (error) {
        console.error('Resend error:', error);
        showError(error.message || 'Failed to resend email');
      }
    });

    // ========== –£–¢–ò–õ–ò–¢–´ UI ==========

    function switchScreen(num) {
      screen1.classList.remove('active');
      screen2.classList.remove('active');

      if (num === 1) screen1.classList.add('active');
      if (num === 2) screen2.classList.add('active');
    }

    function showError(message) {
      errorMsg.textContent = message;
      errorMsg.classList.add('active');
      setTimeout(() => errorMsg.classList.remove('active'), 5000);
    }

    function showSuccess(message) {
      successMsg.textContent = message;
      successMsg.classList.add('active');
      setTimeout(() => successMsg.classList.remove('active'), 3000);
    }

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========

    // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ SUPABASE_CFG –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
    waitForSupabase(() => {
      console.log('üéØ Ready to authenticate');
    });

    // ========== GLOBAL API ==========

    window.sbAuth = {
      switchScreen,
      showError,
      showSuccess,
      reset: () => {
        emailInput.value = '';
        codeInput.value = '';
        codeSection.classList.remove('active');
        showCodeBtn.style.display = '';
        switchScreen(1);
      },
      config: AUTH_CONFIG,
      client: supabaseClient
    };

      } catch (error) {
        console.error('‚ùå Supabase Auth Form initialization error:', error);
        console.log('üí° Check browser console for details');
        // –ù–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –¥–∞–ª—å—à–µ - –ø—É—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
      }
    } // end of initAuthForm()
  })(); // end of IIFE
</script>

<!--
  –ì–û–¢–û–í–û:
  ‚úÖ Supabase SDK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  ‚úÖ Magic Link (signInWithOtp)
  ‚úÖ Verification Code
  ‚úÖ Google OAuth
  ‚úÖ –£–º–Ω—ã–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã (–Ω–æ–≤—ã–π vs —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
  ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ thank you pages
  ‚úÖ WordPress —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

  –ù–ê–°–¢–†–û–ô–ö–ê:
  –ò–∑–º–µ–Ω–∏ AUTH_CONFIG.thankYouPages –¥–ª—è —Å–≤–æ–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü!
-->