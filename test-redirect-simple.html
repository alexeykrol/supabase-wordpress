<style>
    .test-container {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
    }
    .test-info {
        background: #f8f9fa;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        border-left: 4px solid #007bff;
    }
    .test-success {
        background: #d4edda;
        border-left-color: #28a745;
        color: #155724;
    }
    .test-error {
        background: #f8d7da;
        border-left-color: #dc3545;
        color: #721c24;
    }
    .test-code {
        background: #282c34;
        color: #61dafb;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        font-family: monospace;
        font-size: 13px;
        white-space: pre-wrap;
        word-break: break-all;
    }
</style>

<div class="test-container">
    <h1>üß™ Supabase Redirect Test</h1>

    <div class="test-info">
        <strong>Browser:</strong> <span id="browser"></span>
    </div>

    <div class="test-info">
        <strong>Full URL:</strong><br>
        <div class="test-code" id="fullUrl"></div>
    </div>

    <div class="test-info">
        <strong>Hash (after #):</strong><br>
        <div class="test-code" id="hash"></div>
    </div>

    <div id="result" class="test-info"></div>

    <div class="test-info">
        <strong>Console Log:</strong><br>
        <div class="test-code" id="log"></div>
    </div>
</div>

<script>
    const log = (msg) => {
        const time = new Date().toLocaleTimeString();
        const entry = `[${time}] ${msg}`;
        console.log(entry);
        document.getElementById('log').textContent += entry + '\n';
    };

    const detectBrowser = () => {
        const ua = navigator.userAgent;
        if (ua.includes('Firefox')) return 'Firefox';
        if (ua.includes('Chrome')) return 'Chrome';
        if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
        return 'Unknown';
    };

    log('Test started');

    const browser = detectBrowser();
    const fullUrl = window.location.href;
    const hash = window.location.hash;

    document.getElementById('browser').textContent = browser;
    document.getElementById('fullUrl').textContent = fullUrl;
    document.getElementById('hash').textContent = hash || '(empty)';

    log('Browser: ' + browser);
    log('URL: ' + fullUrl);
    log('Hash: ' + (hash || '(empty)'));

    const resultDiv = document.getElementById('result');

    if (hash.includes('access_token=')) {
        resultDiv.className = 'test-info test-success';
        resultDiv.innerHTML = '<strong>‚úÖ SUCCESS!</strong><br>Token found in HASH (correct)<br>Browser: <strong>' + browser + '</strong>';
        log('‚úÖ PASSED - Token in hash');
    } else if (fullUrl.includes('access_token=')) {
        resultDiv.className = 'test-info test-error';
        resultDiv.innerHTML = '<strong>‚ùå ERROR!</strong><br>Token in URL but NOT in hash (# missing)<br>Browser: <strong>' + browser + '</strong>';
        log('‚ùå FAILED - Token without #');
    } else {
        resultDiv.innerHTML = '<strong>‚ÑπÔ∏è No token</strong><br>Click Magic Link to test';
        log('‚ÑπÔ∏è Waiting for redirect');
    }

    log('Test completed');
</script>
